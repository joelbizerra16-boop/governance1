{% extends 'dashboard/base.html' %}
{% block content %}
{% if messages %}
    {% for message in messages %}
        <div class="alert-{{ message.tags }}" style="margin-bottom:18px;padding:12px 18px;border-radius:8px;background:#1e293b;color:#a7f3d0;font-weight:bold;box-shadow:0 2px 8px #2222;">{{ message }}</div>
    {% endfor %}
{% endif %}
<div style="display:flex;align-items:center;gap:12px;">
    <h2 style="margin:0;">Agenda de Reuniões</h2>
    <div style="margin-left:auto;display:flex;gap:10px;">
        <a href="{% url 'dashboard:criar_reuniao' %}" class="btn-modern">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></svg>
            Agendar Reunião
        </a>
        <a href="{% url 'dashboard:reunioes_pdf' %}" class="btn-modern btn-modern--secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M5 20h14v-2H5v2zm7-18l-5 5h3v6h4V7h3l-5-5z"/></svg>
            Exportar PDF
        </a>
    </div>
</div>
<table class="tabela-reunioes" style="width:100%;margin-top:18px;">
    <thead>
    <tr>
            <th>Criação</th>
            <th>Título</th>
            <th>Data</th>
            <th>Próxima Reunião</th>
            <th>Faltam</th>
            <th>Qtde</th>
            <th>Recorrência</th>
            <th>Local</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for reuniao in reunioes %}
        <tr>
            <td>{{ reuniao.criado_em|date:'d/m/Y' }}</td>
            <td>{{ reuniao.titulo }}</td>
            <td>{{ reuniao.data|date:'d/m/Y' }}</td>
            <td>{{ reuniao.proxima_data|date:'d/m/Y' }}</td>
            <td>
                {% if reuniao.pausada %}
                    Pause
                {% else %}
                    {{ reuniao.faltam }}
                {% endif %}
            </td>
            <td>{{ reuniao.qtde }}</td>
            <td>{{ reuniao.recorrencia }}</td>
            <td>{{ reuniao.local }}</td>
            <td>
                <form method="post" action="{% url 'dashboard:toggle_reuniao_pause' reuniao.id %}" style="display:inline; margin-right:8px;">
                    {% csrf_token %}
                    <button type="submit" class="btn-toggle" title="{% if reuniao.pausada %}Retomar{% else %}Pausar{% endif %}" style="background:none;border:none;cursor:pointer;color:#fbbf24;">
                        <span style="vertical-align:middle;">
                            {% if reuniao.pausada %}
                            <!-- Pause icon (state: paused) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#f59e0b"><path d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>
                            {% else %}
                            <!-- Play icon (state: running) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#22c55e"><path d="M8 5v14l11-7z"/></svg>
                            {% endif %}
                        </span>
                    </button>
                </form>
                <a href="#" class="btn-visualizar" title="Visualizar" style="margin-right:8px;color:#93c5fd;" onclick="toggleDetalhes(this); return false;">
                    <span style="vertical-align:middle;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M12 5c-7.633 0-12 7-12 7s4.367 7 12 7 12-7 12-7-4.367-7-12-7zm0 12c-2.761 0-5-2.239-5-5s2.239-5 5-5 5 2.239 5 5-2.239 5-5 5zm0-8c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3z"/></svg>
                    </span>
                </a>
                <a href="{% url 'dashboard:editar_reuniao' reuniao.id %}" class="btn-editar" title="Editar" style="margin-right:6px;color:#60a5fa;">
                    <span style="vertical-align:middle;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#2574e8" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75l11.06-11.06-3.75-3.75L3 17.25zm14.71-10.04a1.003 1.003 0 0 0 0-1.42l-2.5-2.5a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                    </span>
                </a>
                <form method="post" action="{% url 'dashboard:excluir_reuniao' reuniao.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-excluir" title="Excluir" style="background:none;border:none;cursor:pointer;">
                        <span style="vertical-align:middle;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#e82525" viewBox="0 0 24 24"><path d="M6 19c0 1.104.896 2 2 2h8c1.104 0 2-.896 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                        </span>
                    </button>
                </form>
            </td>
        </tr>
    <tr class="detalhes-reuniao" style="display:none;background:#181f2a;">
            <td colspan="8" style="padding:24px 32px;">
                <div style="display:flex;gap:48px;justify-content:center;">
                    <div style="flex:1;min-width:220px;">
                        <h4 style="color:#60a5fa;font-size:1.1em;margin-bottom:10px;font-weight:600;">Dados Gerais</h4>
                        <div><strong>Título:</strong> {{ reuniao.titulo }}</div>
                        <div><strong>Objetivo:</strong> {{ reuniao.objetivo }}</div>
                        <div><strong>Participantes:</strong> {{ reuniao.participantes }}</div>
                        <div><strong>Local:</strong> {{ reuniao.local }}</div>
                        <div><strong>Planta:</strong> {{ reuniao.planta }}</div>
                        <div><strong>Recorrência:</strong> {{ reuniao.recorrencia }}</div>
                        <div><strong>Observações:</strong> {{ reuniao.observacoes }}</div>
                    </div>
                    <div style="flex:1;min-width:220px;">
                        <h4 style="color:#60a5fa;font-size:1.1em;margin-bottom:10px;font-weight:600;">Status & Datas</h4>
                        <div><strong>Data de Criação:</strong> {{ reuniao.criado_em|date:'d/m/Y' }}</div>
                        <div><strong>Data da Reunião:</strong> {{ reuniao.data|date:'d/m/Y' }}</div>
                        <div><strong>Próxima Reunião:</strong> {{ reuniao.proxima_data|date:'d/m/Y' }}</div>
                        <div><strong>Hora:</strong> {{ reuniao.hora|time:'H:i' }}</div>
                        <div><strong>Faltam:</strong> {{ reuniao.faltam }}</div>
                        <div><strong>Qtde ocorrências:</strong> {{ reuniao.qtde }}</div>
                        <div><strong>Status:</strong> {{ reuniao.status }}</div>
                        <div><strong>Último editor:</strong> {% if reuniao.ultimo_editor %}{{ reuniao.ultimo_editor.username }}{% else %}-{% endif %}</div>
                        {% if reuniao.anexos %}
                        <div><strong>Anexos:</strong> <a href="{{ reuniao.anexos.url }}" target="_blank" style="color:#38bdf8;">Download</a></div>
                        {% endif %}
                    </div>
                </div>
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="5">Nenhuma reunião agendada.</td></tr>
        {% endfor %}
    </tbody>
</table>
<script>
function toggleDetalhes(btn) {
    var detalhes = btn.closest('tr').nextElementSibling;
    if (detalhes.style.display === 'none' || detalhes.style.display === '') {
        detalhes.style.display = 'table-row';
    } else {
        detalhes.style.display = 'none';
    }
}
// Confirmações específicas por ação (toggle pausa vs excluir)
document.addEventListener('click', function(e){
    const form = e.target.closest('form');
    const btn = e.target.closest('button');
    if(!form || !btn) return;
    const action = form.getAttribute('action') || '';

    // Excluir reunião
    if(action.includes('/reunioes/') && action.includes('/excluir/')){
        const ok = confirm('Tem certeza que deseja excluir esta reunião?');
        if(!ok){ e.preventDefault(); }
        return;
    }

    // Alternar status (pausar/retomar)
    if(action.includes('/reunioes/') && action.includes('/toggle_pause/')){
        const ok = confirm('Você tem certeza que deseja mudar o status da reunião?');
        if(!ok){ e.preventDefault(); }
        return;
    }
});
</script>
{% endblock %}
